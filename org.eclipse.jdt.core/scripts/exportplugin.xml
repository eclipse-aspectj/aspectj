<?xml version="1.0" encoding="UTF-8"?>

<!-- build script to create a plugin from org.eclipse.jdt.core -->
<project name="org.eclipse.jdt.core" default="export plug-in [_2.0.0]" basedir="..">


<target name="zz_init">
	<tstamp/>
	<property name="export-dir" value="../../plugin-export" />

	<!--  This assumes your workspace is the modules directory of the tree. -->  
	<!-- Otherwise, define the appropriate ant variables - e.g.,            -->
	<!-- -Dexport-dir=o:/plugins                                            -->
	<!-- -Daj.modules.jar.dir=c:/home/wes/aj/aj-build-modules/jars          -->
	<!-- -Daspectj.modules.lib.dir=c:/home/wes/aj/aspectj/modules/lib       -->

    <property name="aspectj.modules.lib.dir"
          location="../lib"/>
    <property name="aj.modules.jar.dir"
          location="../../../aj-build-modules/jars"/>
          
</target>

<target name="zip plug-in [_2.0.0]" depends="zz_init">
	<antcall target="zz_internal_export">
	<param name="dest" value="${export-dir}/org.eclipse.jdt.core_2.0.0"/>
	</antcall>
	<zip zipfile="${aj.modules.jar.dir}/org.eclipse.jdt.core_2.0.0-aspectj.zip">
	  <fileset dir="${export-dir}" includes="org.eclipse.jdt.core_2.0.0"/>
	</zip>
</target>

<target name="export plug-in [_2.0.0]" depends="zz_init">
	<antcall target="zz_internal_export">
	<param name="dest" value="${export-dir}/org.eclipse.jdt.core_2.0.0"/>
	</antcall>
</target>

<target name="export plug-in [_1.9.0]" depends="zz_init">
	<antcall target="zz_internal_export">
	<param name="dest" value="${export-dir}/org.eclipse.jdt.core_1.9.0"/>
	</antcall>
</target>

<target name="export plug-in [no version]" depends="zz_init">
	<antcall target="zz_internal_export">
	<param name="dest" value="${export-dir}/org.eclipse.jdt.core"/>
	</antcall>
</target>

<target name="zz_internal_export">

	<tstamp/>

	<echo message="TARGET: ${export-dir}" />
	<mkdir dir="${export-dir}" />
	<delete dir="${dest}" />
	<mkdir dir="${dest}" />

	<echo message="UPDATE jdtcore.jar" />
	<jar 
		jarfile="${dest}/jdtcore.jar"
		basedir="bin" 
		excludes="**/JDTCompilerAdapter.class"/>
		
	<echo message="UPDATE jdtCompilerAdapter.jar" />
	<jar 
		jarfile="${dest}/jdtCompilerAdapter.jar"
		basedir="bin" 
		includes="**/JDTCompilerAdapter.class"/>

	<echo message="copying aspectj libraries " />
	<copy todir="${dest}">
	  <fileset dir="${aspectj.modules.lib.dir}/bcel"
	      includes="bcel.jar"/>
    </copy>
    
	<echo message="copying aspectj modules - must be built" />
	<copy todir="${dest}">
	  <fileset dir="${aj.modules.jar.dir}"
	      includes="bcweaver.jar,runtime.jar,util.jar"/>
    </copy>

	<echo message="UPDATE plugin.xml" />
	<copy file="plugin.xml" todir="${dest}" />
	<echo message="UPDATE plugin.properties" />
	<copy file="plugin.properties" todir="${dest}" />

	<echo message="UPDATE .options" />
	<copy file=".options" todir="${dest}" />

	<echo message="UPDATE about.html" />
	<copy file="about.html" todir="${dest}" />

	<echo message="UPDATE jdtcoresrc.zip" />
	<zip zipfile="${dest}/jdtcoresrc.zip">
	    <zipfileset dir="antadapter" />
	    <zipfileset dir="batch" />
	    <zipfileset dir="codeassist" />
	    <zipfileset dir="compiler" />
	    <zipfileset dir="dom" />
	    <zipfileset dir="eval" />
	    <zipfileset dir="formatter" />
	    <zipfileset dir="model" />
	    <zipfileset dir="search" />
	    <zipfileset dir="aspectj" />
	</zip>		
	<echo message="DONE" />
</target>

</project>
